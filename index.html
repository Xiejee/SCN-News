<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCN - Songhe Class News</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/3.5.0/remixicon.min.css" rel="stylesheet">
    <style>
        :root {
            /* --- 配色方案 --- */
            --primary-color: #0056b3;   /* 主色调：深蓝 */
            --accent-color: #00a8ff;    /* 强调色：亮蓝 */
            --bg-color: #f4f7f9;        /* 背景色：淡灰 */
            --card-bg: #ffffff;         /* 卡片背景：纯白 */
            --text-main: #2c3e50;       /* 主要文字 */
            --text-secondary: #7f8c8d;  /* 次要文字 */
            --shadow-sm: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 15px 35px rgba(50, 50, 93, 0.1), 0 5px 15px rgba(0, 0, 0, 0.07);
            /* --- 动画曲线 (丝滑的关键) --- */
            --ease-spring: cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--text-main);
            line-height: 1.7;
        }

        /* --- 顶部导航栏 --- */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            background: var(--card-bg);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            letter-spacing: 1px;
            margin: 0;
        }
        
        .app-title span { color: var(--accent-color); }

        /* 关于按钮 - 精致模块化 */
        .about-btn {
            background: var(--bg-color);
            border: none;
            color: var(--text-main);
            font-size: 1.5rem;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.4s var(--ease-spring);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 0 2px transparent;
        }

        .about-btn:hover {
            background: var(--accent-color);
            color: white;
            transform: rotate(90deg);
            box-shadow: var(--shadow-sm);
        }

        /* --- 主内容区域 --- */
        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* --- 新闻卡片设计 (模块化 & 精致) --- */
        .news-card {
            background: var(--card-bg);
            border-radius: 16px; /* 大圆角 */
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
            /* 核心动画属性 */
            transition: all 0.4s var(--ease-spring);
            opacity: 0; /* 初始隐藏，用于入场动画 */
            animation: fadeInUp 0.7s var(--ease-spring) forwards;
            border: 1px solid rgba(0,0,0,0.04);
        }

        /* 鼠标悬停时的丝滑上浮效果 */
        .news-card:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: var(--shadow-hover);
            border-color: rgba(0, 168, 255, 0.2);
        }

        /* 标题突出显示 */
        .news-title-highlight {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 15px;
            position: relative;
            padding-left: 20px;
            /* 左侧装饰条 */
            border-left: 5px solid var(--accent-color);
        }

        .news-meta {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 8px;
            width: fit-content;
        }

        .news-meta i { margin-right: 8px; }

        .news-content {
            white-space: pre-wrap; /* 保留TXT的换行 */
            color: #4a5568;
            font-size: 1.05rem;
        }

        /* --- 入场动画定义 --- */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translate3d(0, 40px, 0);
            }
            to {
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }
        
        /* 为不同的卡片设置交错动画延迟 */
        .news-card:nth-child(1) { animation-delay: 0.1s; }
        .news-card:nth-child(2) { animation-delay: 0.2s; }
        .news-card:nth-child(3) { animation-delay: 0.3s; }
        .news-card:nth-child(n+4){ animation-delay: 0.4s; }


        /* --- 状态提示 & 加载动画 --- */
        #status { text-align: center; margin-top: 60px; color: var(--text-secondary); }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid rgba(0, 168, 255, 0.2);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }


        /* --- 模态框 (About Modal) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); /* 半透明背景 */
            backdrop-filter: blur(5px); /* 毛玻璃效果 */
            display: flex; justify-content: center; align-items: center;
            z-index: 1000;
            opacity: 0; visibility: hidden; /* 初始隐藏状态 */
            transition: all 0.4s var(--ease-spring);
        }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            box-shadow: var(--shadow-hover);
            transform: scale(0.8);
            transition: all 0.4s var(--ease-spring);
            max-width: 400px;
            width: 90%;
            position: relative;
        }
        
        .modal-overlay.active .modal-content { transform: scale(1); }

        .modal-close-btn {
            position: absolute; top: 15px; right: 15px;
            background: #f0f0f0; border: none; width: 36px; height: 36px;
            border-radius: 50%; cursor: pointer; font-size: 1.2rem; color: #666;
            transition: all 0.3s ease;
        }
        .modal-close-btn:hover { background: #e0e0e0; color: #333; }

        .modal-title { font-size: 1.5rem; font-weight: bold; color: var(--primary-color); margin-bottom: 10px; }
        .modal-info-item { margin: 15px 0; color: var(--text-main); font-size: 1.1rem;}
        .modal-label { font-weight: bold; display: block; font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 5px; }
        .dev-email { color: var(--accent-color); text-decoration: none; font-weight: 500; }

    </style>
</head>
<body>

    <nav class="navbar">
        <h1 class="app-title">SCN <span>News</span></h1>
        <button class="about-btn" id="openModalBtn" title="关于程序">
            <i class="ri-information-line"></i>
        </button>
    </nav>

    <div class="container">
        <div id="status">
            <div class="spinner"></div>
            <p>正在连接 SCN 资讯中心...</p>
        </div>
        <div id="news-list">
            </div>
    </div>

    <div class="modal-overlay" id="aboutModal">
        <div class="modal-content">
            <button class="modal-close-btn" id="closeModalBtn"><i class="ri-close-line"></i></button>
            <div class="modal-title">关于程序</div>
            
            <div class="modal-info-item">
                <span class="modal-label">程序名称</span>
                SCN (Songhe Class News)
            </div>
            
            <div class="modal-info-item" style="background: #f8f9fa; padding: 10px; border-radius: 8px;">
                <span class="modal-label">版本号</span>
                <code>1.0.0.20250117</code>
            </div>
            
            <div class="modal-info-item">
                <span class="modal-label">开发者</span>
                JEEX<br>
                <a href="mailto:2428943240@qq.com" class="dev-email">2428943240@qq.com</a>
            </div>
        </div>
    </div>

<script>
    // ===========================
    //  配置区域 (请修改这里!)
    // ===========================
    const CONFIG = {
        username: 'Xiejee', // 例如: 'jeex-dev'
        repo: 'SCN-News',         // 例如: 'scn-news-repo'
        path: 'news',         // TXT 文件存放的文件夹，根目录存则留空 ''
        prefix: 'news_'              // 文件名前缀
    };
    // ===========================


    // --- 模态框交互逻辑 ---
    const modal = document.getElementById('aboutModal');
    const openBtn = document.getElementById('openModalBtn');
    const closeBtn = document.getElementById('closeModalBtn');

    function toggleModal(show) {
        if (show) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; // 防止背景滚动
        } else {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }
    }

    openBtn.addEventListener('click', () => toggleModal(true));
    closeBtn.addEventListener('click', () => toggleModal(false));
    // 点击背景关闭
    modal.addEventListener('click', (e) => {
        if (e.target === modal) toggleModal(false);
    });


    // --- 核心新闻获取逻辑 (保持不变，适配新UI) ---
    async function fetchNews() {
        const newsListDiv = document.getElementById('news-list');
        const statusDiv = document.getElementById('status');

        try {
            // 1. 获取文件列表
            let apiUrl = `https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/${CONFIG.path}`;
            // 处理根目录情况
            if (CONFIG.path === '') {
                 apiUrl = `https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/`;
            }

            const response = await fetch(apiUrl);
            if (!response.ok) {
                if (response.status === 404) throw new Error('找不到指定的仓库或文件夹路径，请检查配置。');
                if (response.status === 403) throw new Error('访问过于频繁 (GitHub API限制)，请稍后再试。');
                throw new Error('无法连接到 GitHub 仓库。');
            }
            
            const files = await response.json();

            // 2. 筛选
            const targetFiles = files.filter(file => 
                file.name.startsWith(CONFIG.prefix) && file.name.endsWith('.txt')
            );

            let allNews = [];

            // 3. 循环读取内容
            // 使用 Promise.all 并行请求，提高加载速度
            const filePromises = targetFiles.map(async file => {
                const res = await fetch(file.download_url);
                const rawText = await res.text();
                
                // 解析
                const titleMatch = rawText.match(/TITLE:\s*(.*)/i);
                const dateMatch = rawText.match(/DATE:\s*(.*)/i);
                const contentParts = rawText.split('---');
                
                if (titleMatch && dateMatch && contentParts.length > 1) {
                    return {
                        title: titleMatch[1].trim(),
                        // 将时间字符串转换为可比较的时间戳
                        timestamp: new Date(dateMatch[1].trim().replace(/-/g, '/')).getTime(),
                        dateStr: dateMatch[1].trim(),
                        content: contentParts.slice(1).join('---').trim()
                    };
                }
                return null;
            });

            // 等待所有文件加载完成
            const results = await Promise.all(filePromises);
            // 过滤掉解析失败的 (null)
            allNews = results.filter(news => news !== null);

            // 4. 按时间戳倒序排列 (新到旧)
            allNews.sort((a, b) => b.timestamp - a.timestamp);

            // 5. 渲染 (应用新的精美 UI 结构)
            statusDiv.style.display = 'none';
            if (allNews.length === 0) {
                statusDiv.innerHTML = "<i class='ri-inbox-line' style='font-size: 3rem; color: #ccc'></i><br>暂无新闻发布";
                statusDiv.style.display = 'block';
                return;
            }

            allNews.forEach((news, index) => {
                const card = document.createElement('div');
                // 添加基础类和用于交错动画的索引
                card.className = `news-card`;
                // 手动设置动画延迟，确保动态添加的元素也有交错效果
                card.style.animationDelay = `${index * 0.1}s`;

                card.innerHTML = `
                    <h2 class="news-title-highlight">${news.title}</h2>
                    <div class="news-meta">
                        <i class="ri-time-line"></i>
                        <span>发布于：${news.dateStr}</span>
                    </div>
                    <div class="news-content">${news.content}</div>
                `;
                newsListDiv.appendChild(card);
            });

        } catch (error) {
            statusDiv.innerHTML = `<i class="ri-error-warning-line" style="font-size: 3rem; color: #e74c3c"></i><br><span style="color:#e74c3c; font-weight:bold;">加载失败</span><br><span style="font-size:0.9rem; color:#666">${error.message}</span>`;
            console.error(error);
        }
    }

    // 初始化
    fetchNews();
</script>

</body>
</html>